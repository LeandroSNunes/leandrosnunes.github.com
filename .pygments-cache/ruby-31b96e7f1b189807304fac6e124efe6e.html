<div class="highlight"><pre><span class="n">namespace</span> <span class="ss">:deploy</span> <span class="k">do</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>

<span class="sr">&lt;h1&gt;task :start do ; end&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">task</span> <span class="ss">:stop</span> <span class="k">do</span> <span class="p">;</span> <span class="k">end</span><span class="o">&lt;</span><span class="sr">/h1&gt;</span>

<span class="sr">&lt;p&gt;   task :restart, :roles =&gt; :app, :except =&gt; { :no_release =&gt; true } do&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span> <span class="n">run</span> <span class="s2">&quot;touch </span><span class="si">#{</span><span class="n">current_path</span><span class="si">}</span><span class="s2">/tmp/restart.txt&quot;</span>
 <span class="k">end</span>
<span class="o">&lt;</span><span class="sr">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span>   <span class="n">task</span> <span class="ss">:database</span><span class="p">,</span> <span class="ss">:roles</span> <span class="o">=&gt;</span> <span class="ss">:app</span> <span class="k">do</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>

<span class="sr">&lt;pre&gt;&lt;code&gt; run &quot;cp </span><span class="si">#{</span><span class="n">deploy_to</span><span class="si">}</span><span class="sr">/</span><span class="c1">#{shared_dir}/database.yml #{release_path}/config/&quot;</span>
<span class="o">&lt;</span><span class="sr">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span>   <span class="k">end</span>
   <span class="n">task</span> <span class="ss">:permission</span><span class="p">,</span> <span class="ss">:roles</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:web</span><span class="p">,</span> <span class="ss">:db</span><span class="p">,</span> <span class="ss">:app</span><span class="o">]</span> <span class="k">do</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>

<span class="sr">&lt;pre&gt;&lt;code&gt; run &quot;chmod 755 </span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="sr">/</span><span class="kp">public</span> <span class="o">-</span><span class="n">R</span><span class="s2">&quot; </span>
<span class="s2">&lt;/code&gt;&lt;/pre&gt;</span>

<span class="s2">&lt;p&gt;   end</span>
<span class="s2">end&lt;/p&gt;</span>

<span class="s2">&lt;p&gt;namespace :assets do&lt;/p&gt;</span>

<span class="s2">&lt;pre&gt;&lt;code&gt;task :symlink, :roles =&amp;gt; :app do</span>
<span class="s2">  assets.create_dir</span>
<span class="s2">      run &amp;lt;&amp;lt;-CMD</span>
<span class="s2">        rm -rf  </span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2">/public/images/upload &amp;amp;&amp;amp;</span>
<span class="s2">        ln -nfs </span><span class="si">#{</span><span class="n">shared_path</span><span class="si">}</span><span class="s2">/upload </span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2">/public/images/upload</span>
<span class="s2">      CMD</span>
<span class="s2">end</span>
<span class="s2">    task :create_dir, :roles =&amp;gt; :app do</span>
<span class="s2">      run &quot;</span><span class="n">mkdir</span> <span class="o">-</span><span class="nb">p</span> <span class="c1">#{shared_path}/upload&quot;</span>
    <span class="k">end</span>
<span class="o">&lt;</span><span class="sr">/code&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="k">end</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>

<span class="sr">&lt;p&gt;after &quot;deploy:assets:symlink&quot;, &#39;deploy:database&#39;</span>
<span class="sr">after &quot;deploy:update_code&quot;, &#39;deploy:permission&#39;</span>
</pre>
</div>
